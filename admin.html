<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - SmartBarber</title>
    <style>
        :root { --dorado: #d4af37; --oscuro: #121212; --gris: #1e1e1e; --rojo: #ff4444; --verde: #4caf50; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--oscuro); color: white; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; text-align: center; }
        
        .admin-panel {
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid var(--dorado);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        input, select { padding: 10px; border-radius: 5px; border: 1px solid #444; background: #000; color: white; margin: 5px; }
        button { background: var(--dorado); color: black; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        
        table { width: 100%; border-collapse: collapse; background: var(--gris); border-radius: 10px; overflow: hidden; margin-top: 20px; }
        th { background: var(--dorado); color: black; padding: 15px; }
        td { padding: 12px; border-bottom: 1px solid #333; text-align: center; }
        .badge { padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .bg-si { background: var(--verde); color: white; }
        .bg-no { background: var(--rojo); color: white; }
    </style>
</head>
<body>

<div class="container">
    <h1>Panel Administrativo üíà</h1>
    
    <div class="admin-panel">
        <h3>‚ûï Registrar Nuevo Miembro</h3>
        <input type="text" id="nuevoNombre" placeholder="Nombre Completo">
        <input type="number" id="nuevoDni" placeholder="DNI">
        <select id="nuevoRol">
            <option value="Estudiante">Estudiante</option>
            <option value="Barbero">Barbero</option>
        </select>
        <button onclick="registrarUsuario()">GUARDAR</button>
    </div>

    <h2>üìç Lista de Miembros en Sistema</h2>
    <button onclick="cargarMiembros()" style="background: #444; color: white; margin-bottom: 10px;">üîÑ Sincronizar con Excel</button>
    
    <table>
        <thead>
            <tr>
                <th>DNI</th>
                <th>Nombre</th>
                <th>Rol</th>
                <th>Cuota</th>
            </tr>
        </thead>
        <tbody id="tabla-miembros">
            <tr><td colspan="4">Cargando datos...</td></tr>
        </tbody>
    </table>
</div>

<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzdIQm3sITKDmYmMqabIV5D4TMkruS1Qrbj3XIo_Amx6iGfgWWdfwoZ-pc6BodKUvd8Vg/exec";

    // 1. FUNCI√ìN PARA CARGAR LA LISTA DESDE EXCEL
    async function cargarMiembros() {
        const tabla = document.getElementById('tabla-miembros');
        try {
            const res = await fetch(`${WEB_APP_URL}?action=getList&t=${Date.now()}`);
            const data = await res.json();
            
            tabla.innerHTML = "";
            data.forEach(m => {
                const badgeClass = m.cuota.toUpperCase() === 'SI' ? 'bg-si' : 'bg-no';
                tabla.innerHTML += `
                    <tr>
                        <td>${m.dni}</td>
                        <td style="text-align: left;">${m.nombre}</td>
                        <td>${m.rol}</td>
                        <td><span class="badge ${badgeClass}">${m.cuota}</span></td>
                    </tr>
                `;
            });
        } catch (e) {
            tabla.innerHTML = "<tr><td colspan='4'>Error al conectar con Google Sheets</td></tr>";
        }
    }

    // 2. FUNCI√ìN PARA REGISTRAR
    async function registrarUsuario() {
        const nombre = document.getElementById('nuevoNombre').value;
        const dni = document.getElementById('nuevoDni').value;
        const rol = document.getElementById('nuevoRol').value;

        if(!nombre || !dni) return alert("Completa todos los campos");

        try {
            const url = `${WEB_APP_URL}?action=add&nombre=${encodeURIComponent(nombre)}&dni=${dni}&rol=${rol}`;
            await fetch(url);
            alert("‚úÖ Guardado correctamente");
            document.getElementById('nuevoNombre').value = "";
            document.getElementById('nuevoDni').value = "";
            cargarMiembros(); // Recargamos la tabla autom√°ticamente
        } catch (e) {
            alert("Enviado. Refresca la lista en unos segundos.");
            cargarMiembros();
        }
    }

    // Cargar al iniciar la p√°gina
    window.onload = cargarMiembros;
</script>

</body>
</html>
